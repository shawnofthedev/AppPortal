@model IEnumerable<AppPortal.Models.LeaveBuyBackRequest>
@{
    ViewBag.Title = "ReportViewer";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h3>Report Viewer</h3>
 
@*<div><a class="btn btn-primary" asp-area="" asp-controller="Payroll" asp-action="BuyBackExportExcel">Export CSV</a></div>*@

<button class="btn btn-primary" id="btnExport" onclick="fnExcelReport()">Export Excel</button>
<iframe id="txtArea1" style="display:none"></iframe>

@if (!Model.Any()) 
{
    <p>There are no requests to display at this time.</p>
}
else
{
    <div> 
        <table id="headerTable" class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th>Employee Number</th>
                    <th>Employee Name</th>
                    <th>Hours Requested</th>
                    <th>Pay Period End</th>
                    <th>Program Number</th>
                    <th>Available Hours</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var request in Model)
                {
                    <tr>
                        <td><div><a asp-controller="Payroll" asp-action="ReportDetail" asp-route-id=@request.Id>@request.EmpNum.ToString()</a></div></td>
                        <td>@request.EmpName</td>
                        <td>@request.HoursRequested</td>
                        <td>@request.PayPeriodEnd.ToShortDateString()</td>
                        <td>@request.ProgramNum</td>
                        <td>@request.AvailableHours</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
<div><a asp-area="" asp-controller="Payroll" asp-action="BuyBackReport">Another Report</a></div>

<script type="text/javascript">
    function fnExcelReport() {
        var tab_text = "<table border='2px'><tr bgcolor='#87AFC6'>";
        var textRange; var j = 0;
        tab = document.getElementById('headerTable'); //id of table

        for (j = 0; j < tab.rows.length; j++) {
            tab_text = tab_text + tab.rows[j].innerHTML + "</tr>"; 
        }

        tab_text = tab_text + "</table>";
        tab_text = tab_text.replace(/<A[^>]*>|<\/A>/g, "");//remove if u want links in your table

        var ua = window.navigator.userAgent;
        var msie = ua.indexOf("MSIE ");

        if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) {      // If Internet Explorer 
            txtArea1.document.open("txt/html","replace");
            txtArea1.document.write(tab_text);
            txtArea1.document.close();
            txtArea1.focus(); 
            sa=txtArea1.document.execCommand("SaveAs",true,"LeaveBuyBack.xls");
        }  
        else                 //other browser not tested on IE 11
            sa = window.open('data:application/vnd.ms-excel,' + encodeURIComponent(tab_text));  

        return (sa);
    }
</script>
